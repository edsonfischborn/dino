const returnElement=e=>"string"==typeof e?document.querySelector(e):e,createElm=e=>document.createElement(e),extractInt=e=>parseInt(e.replace(/[^-0-9]/g,"")),multiClassAdd=(e,...t)=>{e&&t&&t.forEach(t=>{t.classList.add(...e.split(" "))})},multiStyleAdd=(e,...t)=>{t.forEach(t=>{for(let[n,r]of Object.entries(e))t.style[n]=r})},appendCh=(e,t,n)=>{n||(n="beforeEnd"),returnElement(e).insertAdjacentElement(n,returnElement(t))},moveTo=async(e,t,n="x",r=1,a=(()=>!1))=>new Promise(i=>{const o=returnElement(e),l={x:"left",y:"bottom"}[n];let d=extractInt(o.style[l]);d===t&&i();const s=!(d<t),m=()=>{s?d-=r:d+=r,multiStyleAdd({[l]:`${d}px`},o),a()||(()=>d>=t&&!s||d<=t&&s)()?i():requestAnimationFrame(m)};m()}),imgUrl="./images",soundUrl="./sounds",gameDefaultConfig={dirt:"./images/dirt.png",cloud:"./images/cloud.png",reset:"./images/reset-btn.png",smallEnemy:{img:"./images/small-enemy.png",width:30,height:40},mediumEnemy:{img:"./images/medium-enemy.png",width:60,height:46},largeEnemy:{img:"./images/large-enemy.png",width:75,height:49},flyEnemy:{img:"./images/fly-enemy.gif",width:46,height:40},jumpSound:"./sounds/jump.wav",scoreSound:"./sounds/score.wav",overSound:"./sounds/over.wav"},Game=(e=gameDefaultConfig)=>{const t=createElm("main"),n=createElm("strong"),r=createElm("strong"),a=createElm("Strong"),i=createElm("img"),o=createElm("audio"),l=createElm("audio"),d=createElm("audio"),s={dirt:[],enemy:[],cloud:[]};let m=!1,p=null,u=4;const c=()=>!(!m&&!(()=>{const e=s.enemy[0];if(!e)return!1;const t=p.element.getBoundingClientRect(),n=e.getBoundingClientRect();return t.x<n.x+n.width&&t.x+t.width>n.x&&t.y<n.y+n.height&&t.y+t.height>n.y})())&&(g(),appendCh(t,a),appendCh(t,i),m=!0,!0),g=()=>{p.over(),d.play();const e=y();e>f()&&x(e)},y=()=>extractInt(n.innerText),h=e=>n.innerText=`${e}`.padStart(6,"0"),f=()=>{const e=localStorage.getItem("highScore");return e?extractInt(e):null},x=e=>{localStorage.setItem("highScore",e),r.innerText=`HI ${`${e}`.padStart(5,"0")}`},w=(n={})=>{const r=createElm("img");r.setAttribute("src",e.dirt),multiStyleAdd({position:"absolute",bottom:"2px",left:"0px",width:"2000px",...n},r),appendCh(t,r),s.dirt.push(r)},E=n=>{for(let r=0;r<n;r++){const n=createElm("img"),r=["smallEnemy","mediumEnemy"];y()>=200&&r.push("largeEnemy","flyEnemy");const a=r[Math.floor(Math.random()*r.length)],i=s.enemy[s.enemy.length-1],o=[15,45];let l=extractInt(t.style.width)+20,d=5;"flyEnemy"===a&&(d=o[Math.floor(Math.random()*o.length)]),i&&(l=extractInt(i.style.left)+extractInt(i.style.width)+400),n.setAttribute("src",e[a].img),multiStyleAdd({position:"absolute",bottom:`${d}px`,width:`${e[a].width}px`,height:`${e[a].height}px`,left:`${l}px`,zIndex:"2"},n),s.enemy.push(n),appendCh(t,n)}},S=e=>{const t=extractInt(e.style.width);return extractInt(e.style.left)+t<0},b=async()=>{w(),w({left:s.dirt[0].style.width});const e=async t=>{await moveTo(t,extractInt(t.style.left)-4e3,"x",u,()=>{if(c())return!0;if(S(t)){const e=`${extractInt(s.dirt[1].style.left)+extractInt(s.dirt[1].style.width)}px`;return multiStyleAdd({left:e},s.dirt[0]),s.dirt.reverse(),!0}}),c()||e(t)};await Promise.all([e(s.dirt[0]),e(s.dirt[1])])},A=async(e,t)=>{const n=s[t][e];await moveTo(n,extractInt(n.style.left)-4e3,"x",u,()=>!!c()||(S(n)?(s[t].shift(),n.remove(),h(`${y()+10} `),y()%200==0&&(l.play(),u++),!0):void 0))},v=async()=>{E(8),(n=>{for(let r=0;r<n;r++){const n=createElm("img"),r=s.cloud[s.cloud.length-1],a=`${Math.floor(51*Math.random())+10}px`,i=Math.floor(151*Math.random())+100;let o=extractInt(t.style.width)+20;r&&(o=extractInt(r.style.left)+extractInt(r.style.width)+i),n.setAttribute("src",e.cloud),multiStyleAdd({position:"absolute",top:a,width:"72px",left:`${o}px`},n),s.cloud.push(n),appendCh(t,n)}})(4),await Promise.all([...s.enemy.map((e,t)=>A(t,"enemy").then(async()=>{0===t&&(E(),await A(s.enemy.length-1,"enemy"))})),...s.cloud.map((e,t)=>A(t,"cloud"))]),c()||v()};return multiStyleAdd({width:"600px",height:"150px",position:"relative",overflow:"hidden"},t),multiStyleAdd({display:"none"},o,l,d),multiStyleAdd({position:"absolute",color:"#535353",fontSize:"20px",zIndex:"6"},n,r),multiStyleAdd({position:"absolute",color:"#535353",fontSize:"30px",zIndex:"6",fontWeight:"400",letterSpacing:"4px",top:"30%",left:"38%"},a),multiStyleAdd({position:"absolute",zIndex:"6",top:"55%",width:"35px",height:"30px",left:"48%"},i),n.style.right="20px",r.style.right="80px",h(0),x(0|f()),t.classList.add("main"),a.innerText="Game Over!",i.setAttribute("src",e.reset),i.addEventListener("click",()=>location.reload()),o.setAttribute("src",e.jumpSound),l.setAttribute("src",e.scoreSound),d.setAttribute("src",e.overSound),appendCh(t,o,"afterbegin"),appendCh(t,l,"afterbegin"),appendCh(t,d,"afterbegin"),appendCh("body",t,"afterbegin"),{gameEnd:()=>m,addPlayer:e=>{appendCh(t,(p=e).element)},start:async()=>{p.run(),appendCh(t,n,"afterbegin"),appendCh(t,r,"afterbegin"),await Promise.all([b(),v()])},animatePlayer:async(e="jump")=>{m?p.over():"jump"===e?await(async(e=80)=>{p.jump(),o.play(),await moveTo(p.element,e,"y",u*u,c),await moveTo(p.element,10,"y",u/u,c),p.run()})():"runLowered"===e?p.runLowered():"run"===e&&p.run()}}},playerDefaultImgConfig={run:"./images/dino-run.gif",runLowered:"./images/dino-run-lowered.gif",stopped:"./images/dino-stopped.png",stoppedStart:"./images/dino-stopped-start.png",stoppedOver:"./images/dino-stopped-over.png"}; const Player=(e=playerDefaultImgConfig,t=50,n=50,r="transparent")=>{const a=createElm("img"),i=e=>{o()!==e&&(multiStyleAdd({height:`${t}px`,width:`${n}px`},a),a.setAttribute("src",e))},o=()=>{const e=a.getAttribute("src");if(e)return e.split("/").pop()};return multiStyleAdd({width:`${n}px`,height:`${t}px`,backgroundColor:r,position:"absolute",bottom:"10px",left:"10px",zIndex:"5"},a),a.classList.add("player"),i(e.stoppedStart),{element:a,run:()=>i(e.run),runLowered:()=>{i(e.runLowered),multiStyleAdd({height:"auto",width:`${1.2*n}px`},a)},getAnimation:()=>{const t=o();for(let n in e)if(e[n]===t)return n},jump:()=>i(e.stopped),over:()=>i(e.stoppedOver)}};const game=Game(),player=Player();game.addPlayer(player);let started=!1,jump=!1;window.addEventListener("keydown",async e=>{e.preventDefault();const t=e.code;if("ArrowUp"===t||"Space"===t){if(game.gameEnd()&&location.reload(),jump||game.gameEnd())return;started||(game.start(),started=!0),jump=!0,await game.animatePlayer(),jump=!1}else if("ArrowDown"===t){if(jump||game.gameEnd())return;game.animatePlayer("runLowered")}}),window.addEventListener("keyup",async e=>{if(e.preventDefault(),"ArrowDown"===e.code){if(jump||game.gameEnd())return;game.animatePlayer("run")}});